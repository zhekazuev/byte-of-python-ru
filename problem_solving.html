
<!DOCTYPE HTML>
<html lang="ru" >
    <head>
        <meta charset="UTF-8">
        <title>Решение задач · Укус Питона – A Byte of Python по-русски</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="HonKit 4.0.4">
        <meta name="author" content="Swaroop C.H.">
        
        
    
    <link rel="stylesheet" href="gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="gitbook/@honkit/honkit-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="oop.html" />
    
    
    <link rel="prev" href="data_structures.html" />
    

    </head>
    <body>
        
<div class="book honkit-cloak">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Введите условия поиска" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="./">
            
                <a href="./">
            
                    
                    Введение
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="dedication.html">
            
                <a href="dedication.html">
            
                    
                    Посвящение
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="preface.html">
            
                <a href="preface.html">
            
                    
                    Предисловие
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="about_python.html">
            
                <a href="about_python.html">
            
                    
                    О языке Python
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="installation.html">
            
                <a href="installation.html">
            
                    
                    Установка
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="first_steps.html">
            
                <a href="first_steps.html">
            
                    
                    Первые шаги
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="basics.html">
            
                <a href="basics.html">
            
                    
                    Основы
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="op_exp.html">
            
                <a href="op_exp.html">
            
                    
                    Операторы и выражения
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9" data-path="control_flow.html">
            
                <a href="control_flow.html">
            
                    
                    Поток команд
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10" data-path="functions.html">
            
                <a href="functions.html">
            
                    
                    Функции
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11" data-path="modules.html">
            
                <a href="modules.html">
            
                    
                    Модули
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12" data-path="data_structures.html">
            
                <a href="data_structures.html">
            
                    
                    Структуры данных
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.13" data-path="problem_solving.html">
            
                <a href="problem_solving.html">
            
                    
                    Решение задач
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14" data-path="oop.html">
            
                <a href="oop.html">
            
                    
                    Объектно-ориентированное программирование
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15" data-path="io.html">
            
                <a href="io.html">
            
                    
                    Ввод-вывод
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16" data-path="exceptions.html">
            
                <a href="exceptions.html">
            
                    
                    Исключения
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17" data-path="stdlib.html">
            
                <a href="stdlib.html">
            
                    
                    Стандартная библиотека
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.18" data-path="more.html">
            
                <a href="more.html">
            
                    
                    Дополнительно
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19" data-path="what_next.html">
            
                <a href="what_next.html">
            
                    
                    Что дальше
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.20" data-path="floss.html">
            
                <a href="floss.html">
            
                    
                    Приложение: FLOSS
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.21" data-path="about.html">
            
                <a href="about.html">
            
                    
                    Приложение: О книге
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.22" data-path="revision_history.html">
            
                <a href="revision_history.html">
            
                    
                    Приложение: История версий
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.23" data-path="translations.html">
            
                <a href="translations.html">
            
                    
                    Приложение: Переводы
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.24" data-path="translation_howto.html">
            
                <a href="translation_howto.html">
            
                    
                    Приложение: Инструкция по переводу
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.25" data-path="feedback.html">
            
                <a href="feedback.html">
            
                    
                    Обратная связь
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://github.com/honkit/honkit" target="blank" class="gitbook-link">
            Опубликовано с помощью HonKit
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="." >Решение задач</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="решение-задач">Решение задач</h1>
<p>Мы рассмотрели различные части языка Python, и теперь посмотрим, как все эти части работают вместе, проектируя и составляя программу, которая <em>делает</em> что-то полезное. Цель состоит в том, чтобы научиться писать сценарии на языке Python самостоятельно.</p>
<h2 id="задача">Задача</h2>
<p>Перед нами стоит следующая задача:</p>
<blockquote>
<p>Составить программу, которая создаёт резервные копии всех наших важных файлов.</p>
</blockquote>
<p>Хотя задача и проста, информации явно недостаточно, чтобы приступать к её решению. Необходим некоторый дополнительный <em>анализ</em>. Например, как мы выберем, <em>какие</em> файлы необходимо копировать? <em>Как</em> их хранить? <em>Где</em> их хранить?</p>
<p>После надлежащего анализа мы <em>проектируем</em> нашу программу. Мы создаём список, описывающий то, как наша программа должна работать. В данном случае я создал список того, как я себе представляю её работу. Когда вы проектируете программу, у вас может получиться другой результат, поскольку каждый человек представляет себе это по-своему, так что это в порядке вещей.</p>
<ul>
<li>Файлы и каталоги, которые необходимо скопировать, собираются в список.</li>
<li>Резервные копии должны храниться в основном каталоге резерва.</li>
<li>Файлы помещаются в zip-архив.</li>
<li>Именем для zip-архива служит текущая дата и время.</li>
<li>Будем использовать стандартную команду <code>zip</code>, имеющуюся по умолчанию в любом стандартном дистрибутиве GNU/Linux. Обратите внимание, что для этого подойдёт любая команда архивации, если у неё есть интерфейс командной строки, чтобы ей можно было передавать аргументы из нашего сценария.</li>
</ul>
<blockquote>
<p><strong>Для пользователей Windows</strong></p>
<p>Пользователи Windows могут <a href="http://gnuwin32.sourceforge.net/downlinks/zip.php" target="_blank">установить</a> её со <a href="http://gnuwin32.sourceforge.net/packages/zip.htm" target="_blank">страницы проекта GnuWin32</a> и добавить <code>C:\Program Files\GnuWin32\bin</code> к системной переменной окружения <code>PATH</code>, аналогично тому, как <a href="installation.html#dos-prompt">мы это делали для самой команды python</a>.</p>
</blockquote>
<h2 id="решение">Решение</h2>
<p>Как только проект программы более-менее устоялся, можно приступать к написанию кода, который и будет являться <em>реализацией</em> нашего решения.</p>
<p>Сохраните как <code>backup_ver1.py</code>:</p>
<pre><code class="lang-python"><span class="hljs-keyword">import</span> os
<span class="hljs-keyword">import</span> time

<span class="hljs-comment"># 1. Файлы и каталоги, которые необходимо скопировать, </span>
<span class="hljs-comment"># собираются в список.</span>
<span class="hljs-comment"># Пример на Windows:</span>
<span class="hljs-comment"># source = [&apos;&quot;C:\\My Documents&quot;&apos;]</span>
<span class="hljs-comment"># Пример на Mac OS X и Linux:</span>
source = [<span class="hljs-string">&apos;/Users/swa/notes&apos;</span>]
<span class="hljs-comment"># Заметьте, что для имён, содержащих пробелы, необходимо использовать</span>
<span class="hljs-comment"># двойные кавычки внутри строки. Мы могли бы также использовать</span>
<span class="hljs-comment"># необработанную строку, записав [r&apos;C:\My Documents&apos;].</span>

<span class="hljs-comment"># 2. Резервные копии должны храниться </span>
<span class="hljs-comment"># в основном каталоге резерва.</span>
<span class="hljs-comment"># Пример на Windows:</span>
<span class="hljs-comment"># target_dir = &apos;E:\\Backup&apos;</span>
<span class="hljs-comment"># Пример на Mac OS X и Linux:</span>
target_dir = <span class="hljs-string">&apos;/Users/swa/backup&apos;</span>
<span class="hljs-comment"># Подставьте тот путь, который вы будете использовать.</span>

<span class="hljs-comment"># 3. Файлы помещаются в zip-архив.</span>
<span class="hljs-comment"># 4. Именем для zip-архива служит текущая дата и время.</span>
target = target_dir + os.sep + \
         time.strftime(<span class="hljs-string">&apos;%Y%m%d%H%M%S&apos;</span>) + <span class="hljs-string">&apos;.zip&apos;</span>

<span class="hljs-comment"># Создайте целевой каталог, если он отсутствует</span>
<span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> os.path.exists(target_dir):
    os.mkdir(target_dir)  <span class="hljs-comment"># создать каталог</span>

<span class="hljs-comment"># 5. Используем команду &quot;zip&quot; для помещения файлов в zip-архив</span>
zip_command = <span class="hljs-string">&apos;zip -r {0} {1}&apos;</span>.<span class="hljs-built_in">format</span>(target,
                                      <span class="hljs-string">&apos; &apos;</span>.join(source))

<span class="hljs-comment"># Запускаем создание резервной копии</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">&apos;Zip команда:&apos;</span>)
<span class="hljs-built_in">print</span>(zip_command)
<span class="hljs-built_in">print</span>(<span class="hljs-string">&apos;Выполняется:&apos;</span>)
<span class="hljs-keyword">if</span> os.system(zip_command) == <span class="hljs-number">0</span>:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">&apos;Резервная копия успешно создана в&apos;</span>, target)
<span class="hljs-keyword">else</span>:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">&apos;Создание резервной копии НЕ УДАЛОСЬ&apos;</span>)
</code></pre>

<p>Вывод:</p>
<pre><code>$ python backup_ver1.py
Zip команда:
zip -r /Users/swa/backup/20140328084844.zip /Users/swa/notes
Выполняется:
  adding: Users/swa/notes/ (stored 0%)
  adding: Users/swa/notes/blah1.txt (stored 0%)
  adding: Users/swa/notes/blah2.txt (stored 0%)
  adding: Users/swa/notes/blah3.txt (stored 0%)
Резервная копия успешно создана в /Users/swa/backup/20140328084844.zip
</code></pre>

<p>Теперь наступает стадия <em>тестирования</em>, когда мы проверяем, правильно ли работает наша программа. Если она работает не так, как ожидалось, нам придётся заняться её <em>отладкой</em> (дебагом)<sup><a href="#fn_1" id="reffn_1">1</a></sup>, т.е. устранением <em>багов</em> (ошибок) в программе.</p>
<p>Если приведенная выше программа не работает, скопируйте строку, напечатанную после строки <code>Zip команда:</code> в выводе, вставьте ее в командную строку (в GNU/Linux и Mac OS X) / <code>cmd</code> (в Windows), посмотрите, в чем заключается ошибка, и попытайтесь ее исправить. Если она не срабатывает, проверьте справку по команде zip, чтобы выяснить, в чём может быть проблема. Если команда выполнится, проверьте, совпадает ли ваша программа на Python в точности с программой, приведённой выше.</p>
<p><strong>Как это работает</strong></p>
<p>Вы заметили, как мы превратили наш <em>проект</em> в <em>код</em> шаг за шагом.</p>
<p>Мы использовали модули <code>os</code> и <code>time</code>, предварительно импортировав их. Далее мы указали файлы и каталоги для резервного копирования в списке <code>source</code><sup><a href="#fn_2" id="reffn_2">2</a></sup>. Каталог назначения – это каталог, в котором мы сохраняем все резервные копии, и он указывается в переменной <code>target_dir</code>. Именем zip-архива, который мы создаём, будет текущая дата и время, которые генерируются при помощи функции <code>time.strftime()</code>. У него будет расширение <code>.zip</code>, и храниться он будет в каталоге <code>target_dir</code>.</p>
<p>Обратите внимание на употребление переменной <code>os.sep</code> – она содержит разделитель пути для конкретной операционной системы, т.е. он будет <code>&apos;/&apos;</code> в GNU/Linux и Unix<sup><a href="#fn_3" id="reffn_3">3</a></sup>, <code>&apos;\\&apos;</code> в Windows. Использование <code>os.sep</code> вместо этих символов напрямую делает программу переносимой, и она сможет работать на всех этих операционных системах.</p>
<p>Функция <code>time.strftime()</code> принимает в качестве аргумента формат вывода времени, например, такой, как мы указали в программе выше. Символ формата <code>%Y</code> будет замещён годом и столетием. Символ <code>%m</code> будет замещён месяцем в форме числа от <code>01</code> до <code>12</code>, и так далее. Полный список таких символов формата можно найти в <a href="http://docs.python.org/3/library/time.html#time.strftime" target="_blank">справочнике по Python</a>.</p>
<p>Имя конечного zip-файла мы создаём при помощи оператора, который <em>соединяет</em> строки, т.е. объединяет две строки и возвращает новую. После этого мы создаём строку <code>zip_command</code>, которая содержит команду, которую мы намерены выполнить. Проверить, работает ли эта команда, можно запустив её отдельно в командной оболочке (терминал в GNU/Linux или командная строка DOS).</p>
<p>Команда <code>zip</code>, которую мы используем, имеет некоторые параметры. Параметр <code>-r</code> обозначает, что команда архивации должна работать <strong>р</strong>екурсивно<sup><a href="#fn_4" id="reffn_4">4</a></sup> для каталогов, т.е. должна включать все подкаталоги и файлы. За параметрами следует имя создаваемого zip-архива, за которым указывается список файлов и каталогов для резервного копирования. Мы превращаем список <code>source</code> в строку, используя уже знакомый нам метод <code>join</code>.</p>
<p>Затем мы, наконец, <em>выполняем</em> команду при помощи функции <code>os.system</code>, которая запускает команду так, как будто она была запущена из <em>системы</em>, т.е. из командной оболочки. Она возвращает <code>0</code>, если команда выполнена успешно, в противном случае она возвращает код ошибки.</p>
<p>В зависимости от вывода команды, мы печатаем соответствующее сообщение о том, успешным было создание резервных копий или нет.</p>
<p>Вот и всё, мы создали сценарий для сохранения резервных копий наших важных файлов!</p>
<blockquote>
<p><strong>Замечание для пользователей Windows</strong></p>
<p>Вместо управляющей последовательности для обратной наклонной черты могут использоваться &quot;сырые&quot;<sup><a href="#fn_5" id="reffn_5">5</a></sup> строки. Например, можно писать <code>C:\\Documents</code> или <code>r&apos;C:\Documents&apos;</code>. Однако, не используйте <code>&apos;C:\Documents&apos;</code>, так как в этом случае окажется, что вы пытаетесь применить неизвестную управляющую последовательность <code>\D</code>.</p>
</blockquote>
<p>Теперь, когда у нас есть рабочий сценарий резервного копирования, мы можем использовать его для создания копий наших файлов. Это называется <em>операционной</em> фазой или <em>развёртыванием</em> программы.</p>
<p>Программа, приведённая выше, работает корректно, но (обычно) поначалу программы не работают так, как вы того ожидаете. Проблемы могут возникать вследствие неправильного проектирования программы, допущения ошибки при наборе программного кода и т.д. В таких случаях приходится возвращаться к стадии проектирования или отладки программы.</p>
<h2 id="вторая-версия">Вторая версия</h2>
<p>Первая версия нашего сценария работает. Тем не менее, его можно улучшить так, чтобы было удобнее пользоваться в повседневной работе. Это называется стадией <em>поддержки</em> программы.</p>
<p>Одно из улучшений, показавшееся мне полезным, – это лучший механизм именования файлов: использование <em>времени</em> в качестве имени файла, сохраняющегося в каталог с текущей <em>датой</em> в качестве имени, который в свою очередь, расположен в главном каталоге для хранения резервных копий. Первое достоинство этого состоит в том, что копии хранятся в иерархической структуре, которой легче управлять. Второе достоинство – в том, что имена файлов намного короче. Третье достоинство состоит в том, что по именам каталогов можно легко определить, в какие дни создавались резервные копии, так как каталог создаётся только в случае резервного копирования данных в этот день.</p>
<p>Сохраните как <code>backup_ver2.py</code>:</p>
<pre><code class="lang-python"><span class="hljs-keyword">import</span> os
<span class="hljs-keyword">import</span> time

<span class="hljs-comment"># 1. Файлы и каталоги, которые необходимо скопировать, </span>
<span class="hljs-comment"># собираются в список.</span>
<span class="hljs-comment"># Пример на Windows:</span>
<span class="hljs-comment"># source = [&apos;&quot;C:\\My Documents&quot;&apos;, &apos;C:\\Code&apos;]</span>
<span class="hljs-comment"># Пример на Mac OS X и Linux:</span>
source = [<span class="hljs-string">&apos;/Users/swa/notes&apos;</span>]
<span class="hljs-comment"># Заметьте, что для имён, содержащих пробелы, необходимо использовать</span>
<span class="hljs-comment"># двойные кавычки внутри строки.</span>

<span class="hljs-comment"># 2. Резервные копии должны храниться </span>
<span class="hljs-comment"># в основном каталоге резерва.</span>
<span class="hljs-comment"># Пример на Windows:</span>
<span class="hljs-comment"># target_dir = &apos;E:\\Backup&apos;</span>
<span class="hljs-comment"># Пример на Mac OS X и Linux:</span>
target_dir = <span class="hljs-string">&apos;/Users/swa/backup&apos;</span>
<span class="hljs-comment"># Подставьте тот путь, который вы будете использовать.</span>

<span class="hljs-comment"># Создайте целевой каталог, если он отсутствует</span>
<span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> os.path.exists(target_dir):
    os.mkdir(target_dir)  <span class="hljs-comment"># создать каталог</span>

<span class="hljs-comment"># 3. Файлы помещаются в zip-архив.</span>
<span class="hljs-comment"># 4. Текущий день - это имя подкаталога</span>
<span class="hljs-comment"># в главном каталоге.</span>
today = target_dir + os.sep + time.strftime(<span class="hljs-string">&apos;%Y%m%d&apos;</span>)
<span class="hljs-comment"># Текущее время - это имя zip-архива.</span>
now = time.strftime(<span class="hljs-string">&apos;%H%M%S&apos;</span>)

<span class="hljs-comment"># Имя zip-файла</span>
target = today + os.sep + now + <span class="hljs-string">&apos;.zip&apos;</span>

<span class="hljs-comment"># Создайте целевой каталог, если он отсутствует</span>
<span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> os.path.exists(today):
    os.mkdir(today)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">&apos;Каталог успешно создан&apos;</span>, today)

<span class="hljs-comment"># 5. Используем команду &quot;zip&quot; для помещения файлов в zip-архив</span>
zip_command = <span class="hljs-string">&apos;zip -r {0} {1}&apos;</span>.<span class="hljs-built_in">format</span>(target,
                                      <span class="hljs-string">&apos; &apos;</span>.join(source))

<span class="hljs-comment"># Запускаем создание резервной копии</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">&apos;Zip команда:&apos;</span>)
<span class="hljs-built_in">print</span>(zip_command)
<span class="hljs-built_in">print</span>(<span class="hljs-string">&apos;Выполняется:&apos;</span>)
<span class="hljs-keyword">if</span> os.system(zip_command) == <span class="hljs-number">0</span>:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">&apos;Резервная копия успешно создана в&apos;</span>, target)
<span class="hljs-keyword">else</span>:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">&apos;Создание резервной копии НЕ УДАЛОСЬ&apos;</span>)
</code></pre>

<p>Вывод:</p>
<pre><code>$ python backup_ver2.py
Каталог успешно создан /Users/swa/backup/20140329
Zip команда:
zip -r /Users/swa/backup/20140329/073201.zip /Users/swa/notes
Выполняется:
  adding: Users/swa/notes/ (stored 0%)
  adding: Users/swa/notes/blah1.txt (stored 0%)
  adding: Users/swa/notes/blah2.txt (stored 0%)
  adding: Users/swa/notes/blah3.txt (stored 0%)
Резервная копия успешно создана в /Users/swa/backup/20140329/073201.zip
</code></pre>

<p><strong>Как это работает</strong></p>
<p>Большая часть программы осталась прежней. Разница в том, что теперь мы проверяем, существует ли каталог с именем, соответствующем текущей дате, внутри главного каталога для хранения резервных копий. Для этого мы используем функцию <code>os.path.exists</code>. Если он не существует, мы создаём его функцией <code>os.mkdir</code>.</p>
<h2 id="третья-версия">Третья версия</h2>
<p>Вторая версия уже удобнее для работы с большим количеством резервных копий. С другой стороны, когда их много, становится трудно отличить, какая копия для чего. Например, мы могли внести значительные изменения в какую-то программу или презентацию, и теперь хотим указать суть этих изменений в имени zip-архива. Этого легко можно достичь добавлением пользовательского комментария к имени zip-архива.</p>
<p>ПРИМЕЧАНИЕ: Следующая программа не работает, так что не переживайте, просто проследуйте по ней, так как в ней содержится урок.</p>
<p>Сохраните как <code>backup_ver3.py</code>:</p>
<pre><code class="lang-python"><span class="hljs-keyword">import</span> os
<span class="hljs-keyword">import</span> time

<span class="hljs-comment"># 1. Файлы и каталоги, которые необходимо скопировать, </span>
<span class="hljs-comment"># собираются в список.</span>
<span class="hljs-comment"># Пример на Windows:</span>
<span class="hljs-comment"># source = [&apos;&quot;C:\\My Documents&quot;&apos;, &apos;C:\\Code&apos;]</span>
<span class="hljs-comment"># Пример на Mac OS X и Linux:</span>
source = [<span class="hljs-string">&apos;/Users/swa/notes&apos;</span>]
<span class="hljs-comment"># Заметьте, что для имён, содержащих пробелы, необходимо использовать</span>
<span class="hljs-comment"># двойные кавычки внутри строки.</span>

<span class="hljs-comment"># 2. Резервные копии должны храниться </span>
<span class="hljs-comment"># в основном каталоге резерва.</span>
<span class="hljs-comment"># Пример на Windows:</span>
<span class="hljs-comment"># target_dir = &apos;E:\\Backup&apos;</span>
<span class="hljs-comment"># Пример на Mac OS X и Linux:</span>
target_dir = <span class="hljs-string">&apos;/Users/swa/backup&apos;</span>
<span class="hljs-comment"># Подставьте тот путь, который вы будете использовать.</span>

<span class="hljs-comment"># Создайте целевой каталог, если он отсутствует</span>
<span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> os.path.exists(target_dir):
    os.mkdir(target_dir)  <span class="hljs-comment"># создать каталог</span>

<span class="hljs-comment"># 3. Файлы помещаются в zip-архив.</span>
<span class="hljs-comment"># 4. Текущий день - это имя подкаталога</span>
<span class="hljs-comment"># в главном каталоге.</span>
today = target_dir + os.sep + time.strftime(<span class="hljs-string">&apos;%Y%m%d&apos;</span>)
<span class="hljs-comment"># Текущее время - это имя zip-архива.</span>
now = time.strftime(<span class="hljs-string">&apos;%H%M%S&apos;</span>)

<span class="hljs-comment"># Принять комментарий от пользователя, чтобы</span>
<span class="hljs-comment"># создать имя zip-файла</span>
comment = <span class="hljs-built_in">input</span>(<span class="hljs-string">&apos;Введите комментарий --&gt; &apos;</span>)
<span class="hljs-comment"># Проверьте, был ли введен комментарий</span>
<span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(comment) == <span class="hljs-number">0</span>:
    target = today + os.sep + now + <span class="hljs-string">&apos;.zip&apos;</span>
<span class="hljs-keyword">else</span>:
    target = today + os.sep + now + <span class="hljs-string">&apos;_&apos;</span> + 
        comment.replace(<span class="hljs-string">&apos; &apos;</span>, <span class="hljs-string">&apos;_&apos;</span>) + <span class="hljs-string">&apos;.zip&apos;</span>

<span class="hljs-comment"># Создайте целевой каталог, если он отсутствует</span>
<span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> os.path.exists(today):
    os.mkdir(today)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">&apos;Каталог успешно создан&apos;</span>, today)

<span class="hljs-comment"># 5. Используем команду &quot;zip&quot; для помещения файлов в zip-архив</span>
zip_command = <span class="hljs-string">&quot;zip -r {0} {1}&quot;</span>.<span class="hljs-built_in">format</span>(target,
                                      <span class="hljs-string">&apos; &apos;</span>.join(source))

<span class="hljs-comment"># Запускаем создание резервной копии</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">&apos;Zip команда:&apos;</span>)
<span class="hljs-built_in">print</span>(zip_command)
<span class="hljs-built_in">print</span>(<span class="hljs-string">&apos;Выполняется:&apos;</span>)
<span class="hljs-keyword">if</span> os.system(zip_command) == <span class="hljs-number">0</span>:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">&apos;Резервная копия успешно создана в&apos;</span>, target)
<span class="hljs-keyword">else</span>:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">&apos;Создание резервной копии НЕ УДАЛОСЬ&apos;</span>)
</code></pre>

<p>Вывод:</p>
<pre><code>$ python backup_ver3.py
  File &quot;backup_ver3.py&quot;, line 39
    target = today + os.sep + now + &apos;_&apos; +
                                        ^
SyntaxError: invalid syntax
</code></pre>

<p><strong>Как это (не) работает</strong></p>
<p><em>Эта программа не работает!</em> Python сообщает об обнаружении ошибки синтаксиса, что означает, что сценарий не удовлетворяет структуре, которую ожидает увидеть Python. Когда Python выдаёт сообщение об ошибке, он также указывает нам на место ошибки. Так что мы начинаем <em>отладку</em> программы с этой строки.</p>
<p>При внимательном рассмотрении, мы видим, что одна логическая строка была разбита на две физические строки, но мы не указали, что эти две физические строки являются частью одной. На деле же Python просто обнаружил оператор сложения (<code>+</code>) без соответствующего операнда в той же логической строке, а поэтому не знает, как продолжать. Помните, что мы можем указать, что логическая строка продолжается на следующей физической при помощи обратной наклонной черты в конце физической строки. Внесём это исправление в нашу программу. Коррекция программы при обнаружении ошибок и называется <em>отладкой</em><sup><a href="#fn_6" id="reffn_6">6</a></sup>.</p>
<h2 id="четвёртая-версия">Четвёртая версия</h2>
<p>Сохраните как <code>backup_ver4.py</code>:</p>
<pre><code class="lang-python"><span class="hljs-keyword">import</span> os
<span class="hljs-keyword">import</span> time

<span class="hljs-comment"># 1. Файлы и каталоги, которые необходимо скопировать, </span>
<span class="hljs-comment"># собираются в список.</span>
<span class="hljs-comment"># Пример на Windows:</span>
<span class="hljs-comment"># source = [&apos;&quot;C:\\My Documents&quot;&apos;, &apos;C:\\Code&apos;]</span>
<span class="hljs-comment"># Пример на Mac OS X и Linux:</span>
source = [<span class="hljs-string">&apos;/Users/swa/notes&apos;</span>]
<span class="hljs-comment"># Заметьте, что для имён, содержащих пробелы, необходимо использовать</span>
<span class="hljs-comment"># двойные кавычки внутри строки.</span>

<span class="hljs-comment"># 2. Резервные копии должны храниться </span>
<span class="hljs-comment"># в основном каталоге резерва.</span>
<span class="hljs-comment"># Пример на Windows:</span>
<span class="hljs-comment"># target_dir = &apos;E:\\Backup&apos;</span>
<span class="hljs-comment"># Пример на Mac OS X и Linux:</span>
target_dir = <span class="hljs-string">&apos;/Users/swa/backup&apos;</span>
<span class="hljs-comment"># Подставьте тот путь, который вы будете использовать.</span>

<span class="hljs-comment"># Создайте целевой каталог, если он отсутствует</span>
<span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> os.path.exists(target_dir):
    os.mkdir(target_dir)  <span class="hljs-comment"># создать каталог</span>

<span class="hljs-comment"># 3. Файлы помещаются в zip-архив.</span>
<span class="hljs-comment"># 4. Текущий день - это имя подкаталога</span>
<span class="hljs-comment"># в главном каталоге.</span>
today = target_dir + os.sep + time.strftime(<span class="hljs-string">&apos;%Y%m%d&apos;</span>)
<span class="hljs-comment"># Текущее время - это имя zip-архива.</span>
now = time.strftime(<span class="hljs-string">&apos;%H%M%S&apos;</span>)

<span class="hljs-comment"># Принять комментарий от пользователя, чтобы</span>
<span class="hljs-comment"># создать имя zip-файла</span>
comment = <span class="hljs-built_in">input</span>(<span class="hljs-string">&apos;Введите комментарий --&gt; &apos;</span>)
<span class="hljs-comment"># Проверьте, был ли введен комментарий</span>
<span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(comment) == <span class="hljs-number">0</span>:
    target = today + os.sep + now + <span class="hljs-string">&apos;.zip&apos;</span>
<span class="hljs-keyword">else</span>:
    target = today + os.sep + now + <span class="hljs-string">&apos;_&apos;</span> + \
        comment.replace(<span class="hljs-string">&apos; &apos;</span>, <span class="hljs-string">&apos;_&apos;</span>) + <span class="hljs-string">&apos;.zip&apos;</span>

<span class="hljs-comment"># Создайте целевой каталог, если он отсутствует</span>
<span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> os.path.exists(today):
    os.mkdir(today)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">&apos;Каталог успешно создан&apos;</span>, today)

<span class="hljs-comment"># 5. Используем команду &quot;zip&quot; для помещения файлов в zip-архив</span>
zip_command = <span class="hljs-string">&apos;zip -r {0} {1}&apos;</span>.<span class="hljs-built_in">format</span>(target,
                                      <span class="hljs-string">&apos; &apos;</span>.join(source))

<span class="hljs-comment"># Запускаем создание резервной копии</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">&apos;Zip команда:&apos;</span>)
<span class="hljs-built_in">print</span>(zip_command)
<span class="hljs-built_in">print</span>(<span class="hljs-string">&apos;Выполняется:&apos;</span>)
<span class="hljs-keyword">if</span> os.system(zip_command) == <span class="hljs-number">0</span>:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">&apos;Резервная копия успешно создана в&apos;</span>, target)
<span class="hljs-keyword">else</span>:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">&apos;Создание резервной копии НЕ УДАЛОСЬ&apos;</span>)
</code></pre>

<p>Вывод:</p>
<pre><code>$ python backup_ver4.py
Введите комментарий --&gt; added new examples
Zip команда:
zip -r /Users/swa/backup/20140329/074122_added_new_examples.zip /Users/swa/notes
Выполняется:
  adding: Users/swa/notes/ (stored 0%)
  adding: Users/swa/notes/blah1.txt (stored 0%)
  adding: Users/swa/notes/blah2.txt (stored 0%)
  adding: Users/swa/notes/blah3.txt (stored 0%)
Резервная копия успешно создана в /Users/swa/backup/20140329/074122_added_new_examples.zip
</code></pre>

<p><strong>Как это работает</strong></p>
<p>Теперь эта программа работает! Давайте просмотрим все улучшения, сделанные нами для версии 3. Мы запрашиваем пользовательский комментарий при помощи функции <code>input</code>, а затем проверяем, ввёл ли пользователь что-либо, определяя длину введённой строки функцией <code>len</code>. Если пользователь просто нажал <code>enter</code>, не вводя никакого текста (может быть, это было регулярное создание резервной копии, или никаких особых изменений внесено не было), мы продолжаем так же, как делали до сих пор.</p>
<p>Если же комментарий был введён, он добавляется к имени zip-архива перед расширением <code>.zip</code>. Обратите внимание, что мы заменяем пробелы в комментарии подчёркиваниями: управлять файлами без пробелов в именах намного легче.</p>
<h2 id="дополнительные-усовершенствования">Дополнительные усовершенствования</h2>
<p>Четвёртая версия – вполне удовлетворительный рабочий сценарий для большинства пользователей, однако нет пределов совершенства. Например, в программу можно добавить уровень <em>подробности</em><sup><a href="#fn_7" id="reffn_7">7</a></sup> вывода, чтобы при указании параметра <code>-v</code> она становилась более &quot;разговорчивой&quot; или параметр <code>-q</code> чтобы сделать это <em>тихо</em><sup><a href="#fn_8" id="reffn_8">8</a></sup>.</p>
<p>Ещё одним возможным улучшением была бы возможность передавать сценарию другие файлы и каталоги прямо в командной строке. Эти имена можно получать из списка <code>sys.argv</code> и добавлять к нашему списку <code>source</code> при помощи метода <code>extend</code> класса <code>list</code>.</p>
<p>Наиболее важным усовершенствованием было бы прекращение использования <code>os.system</code> для создания архивов, а применение вместо него встроенных модулей <a href="http://docs.python.org/3/library/zipfile.html" target="_blank">zipfile</a> или <a href="http://docs.python.org/3/library/tarfile.html" target="_blank">tarfile</a>. Они являются частью стандартной библиотеки, поэтому всегда доступны для использования без зависимости от внешней программы zip на компьютере.</p>
<p>В приведённых примерах мы использовали способ с <code>os.system</code> для создания резервных копий исключительно в педагогических целях, чтобы пример был достаточно прост для понимания любым читателем, но достаточно реален для того, чтобы делать что-то полезное.</p>
<p>Попробуйте написать пятую версию с использованием модуля <a href="http://docs.python.org/3/library/zipfile.html" target="_blank">zipfile</a> вместо вызова <code>os.system</code>.</p>
<h2 id="процесс-разработки-программного-обеспечения">Процесс разработки программного обеспечения</h2>
<p>В процессе создания программы мы прошли через несколько <em>стадий</em>. Эти стадии можно свести примерно в такой список:</p>
<ol>
<li>Что (Анализ)</li>
<li>Как (Проектирование)</li>
<li>Создание (Реализация)</li>
<li>Тестирование (Тестирование и Отладка)</li>
<li>Использование (Развёртывание и Оперирование)</li>
<li>Поддержка (Усовершенствование)</li>
</ol>
<p>Процедура, которую мы прошли при написании сценария создания резервных копий рекомендуется и для других программ: Проведите анализ и проектирование. Начните реализацию с простейшей версии. Протестируйте и отладьте её. Попользуйтесь ею, чтобы убедиться, что она работает, как ожидалось. После этого добавляйте любые необходимые функции, повторяя цикл &quot;Создание-Тестирование-Использование&quot; столько раз, сколько потребуется.</p>
<p>Помните:</p>
<blockquote>
<p>Программы выращиваются, а не строятся.
-- <a href="http://97things.oreilly.com/wiki/index.php/Great_software_is_not_built,_it_is_grown" target="_blank">Bill de hÓra</a></p>
</blockquote>
<h2 id="резюме">Резюме</h2>
<p>Мы увидели, как создавать свои собственные программы/сценарии на Python, а также различные стадии написания программ. На данном этапе вам будет полезно создать собственную программу по такому рецепту, как мы это делали в настоящей главе, чтобы лучше привыкнуть к Python, равно как и к решению задач.</p>
<p>Далее мы обсудим объектно-ориентированное программирование.</p>
<h2 id="примечания">Примечания</h2>
<blockquote id="fn_1">
<sup>1</sup>. debug – применительно к компьютерным программам обозначает отладку (обнаружение и устранение ошибок, которые при этом принято называть &quot;bug&quot;, т.е. &quot;жук&quot;). По всей видимости, это берёт своё начало с процедуры изгнания насекомых из схем больших ЭВМ, хотя само понятие &quot;bug&quot; в смысле маленькой неисправности встречается и в более ранней литературе, например, в записях Томаса Эдисона 1878 года. (прим. перев.)<a href="#reffn_1" title="Jump back to footnote [1] in the text."> ↩</a>
</blockquote>
<blockquote id="fn_2">
<sup>2</sup>. source – англ. &quot;источник&quot; (прим.перев.)<a href="#reffn_2" title="Jump back to footnote [2] in the text."> ↩</a>
</blockquote>
<blockquote id="fn_3">
<sup>3</sup>. Под словом &quot;Unix&quot; здесь подразумеваются все операционные системы, построенные по принципам ОС Unix, а не только она сама по себе. Примерами таких операционных систем являются все дистрибутивы GNU/Linux, семейство ОС *BSD, Android, Solaris и т.д. (прим.перев.)<a href="#reffn_3" title="Jump back to footnote [3] in the text."> ↩</a>
</blockquote>
<blockquote id="fn_4">
<sup>4</sup>. recursive – англ. &quot;рекурсивно&quot; (прим.перев.)<a href="#reffn_4" title="Jump back to footnote [4] in the text."> ↩</a>
</blockquote>
<blockquote id="fn_5">
<sup>5</sup>. raw – англ. &quot;сырой&quot;, &quot;необработанный&quot; (прим.перев)<a href="#reffn_5" title="Jump back to footnote [5] in the text."> ↩</a>
</blockquote>
<blockquote id="fn_6">
<sup>6</sup>. bug fixing – устранение &quot;багов&quot;, исправление ошибок (прим.перев)<a href="#reffn_6" title="Jump back to footnote [6] in the text."> ↩</a>
</blockquote>
<blockquote id="fn_7">
<sup>7</sup>. verbosity – англ. &quot;многословность&quot;. Применительно к компьютерным программам обозначает степень подробности выводимых программой сообщений, т.е. степень &quot;разговорчивости&quot; программы. Отсюда и название этого параметра (прим.перев)<a href="#reffn_7" title="Jump back to footnote [7] in the text."> ↩</a>
</blockquote>
<blockquote id="fn_4">
<sup>4</sup>. quiet – англ. &quot;тихо&quot; (прим.перев.)<a href="#reffn_4" title="Jump back to footnote [4] in the text."> ↩</a>
</blockquote>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="data_structures.html" class="navigation navigation-prev " aria-label="Previous page: Структуры данных">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="oop.html" class="navigation navigation-next " aria-label="Next page: Объектно-ориентированное программирование">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Решение задач","level":"1.13","depth":1,"next":{"title":"Объектно-ориентированное программирование","level":"1.14","depth":1,"path":"oop.md","ref":"oop.md","articles":[]},"previous":{"title":"Структуры данных","level":"1.12","depth":1,"path":"data_structures.md","ref":"data_structures.md","articles":[]},"dir":"ltr"},"config":{"plugins":[],"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"theme":"default","author":"Swaroop C.H.","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56},"embedFonts":false},"producer":"Swaroopch C.H.","structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"isbn":"","variables":{"buyBookUrl":"https://swaroopch.com/buybook","officialRuUrl":"https://zhekazuev.github.io/byte-of-python-ru/","py_version":"3.8","downloadRuUrl":"https://github.com/zhekazuev/byte-of-python-ru/releases/latest","py_min_release":"3.6.8","officialUrl":"https://python.swaroopch.com","authorUrl":"https://swaroopch.com/about","downloadUrl":"https://github.com/swaroopch/byte-of-python/releases/latest","vimBookUrl":"https://vim.swaroopch.com/byte-of-vim.pdf","contactUrl":"https://swaroopch.com/contact","sourceRuUrl":"https://github.com/zhekazuev/byte-of-python-ru/","py_release":"3.8.6","sourceUrl":"https://github.com/swaroopch/byte-of-python","py_min_version":"3.6","pythonVersion":"3.6.0"},"series":"Byte of","title":"Укус Питона – A Byte of Python по-русски","language":"ru","gitbook":"*","publisher":"Swaroop C.H."},"file":{"path":"problem_solving.md","mtime":"2022-10-23T15:14:46.961Z","type":"markdown"},"gitbook":{"version":"4.0.4","time":"2022-10-23T15:15:02.340Z"},"basePath":".","book":{"language":""}});
        });
    </script>
</div>

        
    <noscript>
        <style>
            .honkit-cloak {
                display: block !important;
            }
        </style>
    </noscript>
    <script>
        // Restore sidebar state as critical path for prevent layout shift
        function __init__getSidebarState(defaultValue){
            var baseKey = "";
            var key = baseKey + ":sidebar";
            try {
                var value = localStorage[key];
                if (value === undefined) {
                    return defaultValue;
                }
                var parsed = JSON.parse(value);
                return parsed == null ? defaultValue : parsed;
            } catch (e) {
                return defaultValue;
            }
        }
        function __init__restoreLastSidebarState() {
            var isMobile = window.matchMedia("(max-width: 600px)").matches;
            if (isMobile) {
                // Init last state if not mobile
                return;
            }
            var sidebarState = __init__getSidebarState(true);
            var book = document.querySelector(".book");
            // Show sidebar if it enabled
            if (sidebarState && book) {
                book.classList.add("without-animation", "with-summary");
            }
        }

        try {
            __init__restoreLastSidebarState();
        } finally {
            var book = document.querySelector(".book");
            book.classList.remove("honkit-cloak");
        }
    </script>
    <script src="gitbook/gitbook.js"></script>
    <script src="gitbook/theme.js"></script>
    
        
        <script src="gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

