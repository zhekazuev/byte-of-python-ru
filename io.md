# Ввод-вывод {#io}

Рано или поздно возникают ситуации, когда программа должна взаимодействовать с пользователем. Например, принять какие-нибудь данные от пользователя, а затем вывести результаты. Для этого применяются функции `input()` и `print()` соответственно.

Для вывода можно также использовать различные методы класса `str` (строка). К примеру, при помощи метода `rjust` можно получить строку, выравненную по правому краю к указанной ширине. См. `help(str)` для более подробного описания.

Ещё одним распространённым типом ввода/вывода является работа с файлами. Возможность создавать, читать и записывать в файлы является ключевой для многих программ, поэтому в настоящей главе и мы рассмотрим этот аспект.

## Ввод от пользователя

Сохраните эту программу как `io_input.py`:

<pre><code class="lang-python">{% include "./programs/io_input.py" %}</code></pre>

Вывод:

<pre><code>{% include "./programs/io_input.txt" %}</code></pre>

**Как это работает**

Мы применяем операцию среза для переворачивания текста. Мы уже видели, как создаются [срезы из последовательностей](./data_structures.md#sequence) при помощи кода `seq[a:b]`, начиная с позиции `a` до позиции `b`. Но ведь мы также можем указать и третий аргумент, определяющий _шаг_, с которым производится срез. По умолчанию шаг равен `1`, поэтому и возвращается непрерывный фрагмент текста. Указание отрицательного шага, т.е. `-1` приведёт к выводу текста в обратном порядке.

Функция `input()` принимает строку в качестве аргумента и показывает её пользователю. Затем она ждёт, чтобы пользователь набрал что-нибудь и нажал клавишу ввода. Как только пользователь это сделал, функция `input()` возвращает введённый пользователем текст.

Мы считываем этот текст и выстраиваем его в обратном порядке. Если перевёрнутый и исходный текст одинаковы, значит введённый текст является [палиндромом](http://en.wiktionary.org/wiki/palindrome).

### Домашнее задание 

Проверка, является ли текст палиндромом должна также игнорировать знаки пунктуации, пробелы и регистр букв. Например, "А роза упала на лапу Азора" также является палиндромом, но наша текущая программа так не считает. Попробуйте улучшить её так, чтобы она распознала этот палиндром.

Если вам нужна подсказка, идея заключается в том, что...[^1]

## Файлы

Открывать и использовать файлы для чтения или записи можно путём создания объекта класса `file`, а читать/записывать в файл – при помощи его методов `read`, `readline` или `write` соответственно. Возможность читать или записывать в файл зависит от режима, указанного при открытии файла. По окончании работы с файлом, нужно вызвать метод `close`[^2], чтобы указать Python, что файл больше не используется.

Пример (сохраните как `io_using_file.py`):

<pre><code class="lang-python">{% include "./programs/io_using_file.py" %}</code></pre>

Вывод:

<pre><code>{% include "./programs/io_using_file.txt" %}</code></pre>

**Как это работает**

Сперва мы открываем файл при помощи встроенной функции `open` с указанием имени файла и режима, в котором мы хотим его открыть. Режим может быть для чтения (`'r'`), записи (`'w'`) или добавления (`'a'`)[^3]. Можно также указать, в каком виде мы будем считывать, записывать или добавлять данные: в текстовом (`'t'`) или бинарном (`'b'`). На самом деле существует много других режимов, и `help(open)` даст вам их детальное описание. По умолчанию `open()` открывает файл как текст в режиме для чтения.

В нашем примере мы сначала открываем файл в режиме записи текста и используем метод `write` файлового объекта для записи в файл, после чего закрываем файл при помощи `close`.

Далее мы открываем тот же самый файл для чтения. В этом случае нет нужды указывать режим, так как режим “чтения текстового файла” применяется по умолчанию. Мы считываем файл построчно методом `readline` в цикле. Этот метод возвращает полную строку, включая символ перевода строки в конце. Когда же он возвращает _пустую_ строку, это означает, что мы достигли конца файла, и мы прерываем цикл при помощи `break`.

И, наконец, мы закрываем файл с помощью `close`.

Теперь проверяем содержимое файла `poem.txt`, чтобы убедиться, что программа действительно записала текст в него и считала из него.

## Pickle

Python предоставляет стандартный модуль с именем `pickle`[^4], при помощи которого можно сохранять _любой_ объект Python в файле, а затем извлекать его обратно. Это называется *длительным* хранением объекта.

Пример (сохраните как `io_pickle.py`):

<pre><code class="lang-python">{% include "./programs/io_pickle.py" %}</code></pre>

Вывод:

<pre><code>{% include "./programs/io_pickle.txt" %}</code></pre>

**Как это работает**

Чтобы сохранить объект в файле, нам нужно сперва открыть файл с помощью `open` в режиме бинарной записи (`'wb'`), после чего вызвать функцию `dump` из модуля `pickle`. Этот процесс называется _консервацией_ ("pickling").

После этого мы извлекаем объект при помощи функции `load` из модуля `pickle`, которая возвращает объект. Этот процесс называется _расконсервацией_ ("unpickling").

## Юникод

До сих пор, когда мы писали и использовали строки или читали и записывали в файл, мы использовали только простые английские символы. Как английские, так и неанглийские символы могут быть представлены в Юникоде (дополнительную информацию см. в статьях в конце этого раздела), и Python 3 по умолчанию хранит строковые переменные (вспомните весь тот текст, который мы написали, используя одинарные, двойные или тройные кавычки) в Юникоде.  

> ПРИМЕЧАНИЕ: Если вы используете Python 2, и мы хотим иметь возможность читать и писать на других неанглийских языках, нам нужно использовать тип `unicode`, и все начинается с символа `u`, например, `u"hello world"`.

```python
>>> "hello world"
'hello world'
>>> type("hello world")
<class 'str'>
>>> u"hello world"
'hello world'
>>> type(u"hello world")
<class 'str'>
```

Когда данные передаются через Интернет, мы должны отправлять их в байтах... , что ваш компьютер легко понимает. Правила перевода Unicode (именно его использует Python при хранении строки) в байты называются кодировкой. Популярной кодировкой является UTF-8. Мы можем читать и писать в UTF-8, используя простой аргумент ключевого слова в нашей функции `open`.

<pre><code class="lang-python">{% include "./programs/io_unicode.py" %}</code></pre>

**Как это работает**

Мы используем `io.open` и затем используем аргумент `encoding` в первом операторе open для кодирования сообщения, а затем снова во втором операторе open при декодировании сообщения. Обратите внимание, что мы должны использовать кодировку в операторе open только в текстовом режиме.

Всякий раз, когда мы пишем программу, использующую символы Unicode (помещая `u` перед строкой), как мы использовали выше, мы должны убедиться, что Python сам сообщает, что наша программа использует UTF-8, и мы должны поместить комментарий `# encoding=utf-8` в верхней части нашей программы.  

Вы должны узнать больше об этой теме, прочитав:

- ["The Absolute Minimum Every Software Developer Absolutely, Positively Must Know About Unicode and Character Sets"](http://www.joelonsoftware.com/articles/Unicode.html)
- [Python Unicode Howto](http://docs.python.org/3/howto/unicode.html)
- [Pragmatic Unicode talk by Nat Batchelder](http://nedbatchelder.com/text/unipain.html)

## Резюме

Мы обсудили разные типы ввода/вывода, а также работу с файлами и использование модуля pickle.

Далее мы познакомимся с концепцией исключений.

---

[^1]: Используйте кортеж (вы можете найти список _всех_ [знаков препинания здесь](http://grammar.ccc.commnet.edu/grammar/marks/marks.htm)) для хранения всех запрещенных символов, затем используйте тест принадлежности, чтобы определить, должен ли символ быть удален или нет, т.е. forbidden = (`!`, `?`, `.`, ...).

[^2] close – англ. "закрывать" (прим.перев)

[^3] read, write и append соответственно (прим.перев.)

[^4] pickle – англ. "мариновать", "солить" (прим.перев.)
